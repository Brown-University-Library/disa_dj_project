{% extends "disa_app_templates/redesign_base.html" %}
{% load staticfiles %}

{% block header_other %}

<!-- Styles -->

<link rel="stylesheet" type="text/css" href="{% static 'css/redesign_citation.css' %}">
<link rel="stylesheet" href="{% static 'css/tagify.css' %}"></link>

<style>

  .disa-id-badge {
    font-size: 12px;
  }

  .disa-id-badge {
    cursor: pointer;
  }

  .card-header.clickable {
    cursor: pointer;
  }

  .card-header.clickable:hover .sr-referent-heading {
    text-decoration: underline;
  }

  #save-status {
    position: fixed;
    left: 10px;
    bottom: 10px;
    transition-property: background-color;
    transition-duration: 0.2s;
  }

  #item-selector-modal .modal-body li {
    cursor: pointer;
  }

  .disa-tags-input {
    display: inline-block;
  }

  #save-status.bg-success {
    -webkit-animation: heartbeat 1.5s ease-in-out both;
            animation: heartbeat 1.5s ease-in-out both;
  }

  .delete-link {
    visibility: hidden;
  }

  .card-header:hover .delete-link,
  .card.is-current .delete-link {
    visibility: initial;
  }

  /* Source for arrow characters
     https://www.fileformat.info/info/unicode/block/geometric_shapes/images.htm */

  .sr-referent-heading::before {
    content: "▶ ";
  }

  .is-current .sr-referent-heading::before {
    content: "▼ ";
  }

  /* ----------------------------------------------
 * Generated by Animista on 2021-5-13 16:43:25
 * Licensed under FreeBSD License.
 * See http://animista.net/license for more info. 
 * w: http://animista.net, t: @cssanimista
 * ---------------------------------------------- */

/**
 * ----------------------------------------
 * animation heartbeat
 * ----------------------------------------
 */

@-webkit-keyframes heartbeat {
  from {
    -webkit-transform: scale(1);
            transform: scale(1);
    -webkit-transform-origin: center center;
            transform-origin: center center;
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
  10% {
    -webkit-transform: scale(0.91);
            transform: scale(0.91);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  17% {
    -webkit-transform: scale(0.98);
            transform: scale(0.98);
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
  33% {
    -webkit-transform: scale(0.87);
            transform: scale(0.87);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  45% {
    -webkit-transform: scale(1);
            transform: scale(1);
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
}
@keyframes heartbeat {
  from {
    -webkit-transform: scale(1);
            transform: scale(1);
    -webkit-transform-origin: center center;
            transform-origin: center center;
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
  10% {
    -webkit-transform: scale(0.91);
            transform: scale(0.91);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  17% {
    -webkit-transform: scale(0.98);
            transform: scale(0.98);
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
  33% {
    -webkit-transform: scale(0.87);
            transform: scale(0.87);
    -webkit-animation-timing-function: ease-in;
            animation-timing-function: ease-in;
  }
  45% {
    -webkit-transform: scale(1);
            transform: scale(1);
    -webkit-animation-timing-function: ease-out;
            animation-timing-function: ease-out;
  }
}


</style>

<!-- Scripts -->

<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<!-- Production version of Vue: <script src="https://cdn.jsdelivr.net/npm/vue@2"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.1/umd/popper.min.js" integrity="sha512-g2PN+aYR0KupTVwea5Ppqw4bxWLLypWdd+h7E0ydT8zF+/Y2Qpk8Y1SnzVw6ZCVJPrgB/91s3VfhVhP7Y4+ucw==" crossorigin="anonymous"></script>
<script src="{% static 'js/tagify.min.js' %}" type="module"></script>

<!-- Bundle of JS modules -->
<!--<script src="{% static 'js/bundle.js' %}" type="module"></script> -->
<!-- Non-bundled JS modules -->
<script src="{% static 'js/entry_form_citation.js' %}" type="module"></script>

<!-- <script src="{% static 'js/tinymce.min.js' %}"></script> -->
<script src="https://cdn.tiny.cloud/1/ondkaoffzc1dnoz0vypajv5qg9fvnun0bss1ew22yncnvquc/tinymce/5/tinymce.min.js" referrerpolicy="origin"></script>
<script type="text/javascript">
    var API_URL_ROOT = "{{ API_URL_ROOT }}", // eg `http://127.0.0.1:8000/data/`` -- or the proper dev or production /data/ root url -- used to build other api endpoints.
        data_itemrecord_api_url_root = "{{ data_itemrecord_api_url_root }}",  // needed by `redesign_data.js`
        TOKEN = "{{ csrf_token }}";
</script>

{% endblock header_other %}

<!-- Just a note that we could have page-specific sidebar documentation here, if desired. -->

{% block sidebar %}
{% endblock sidebar %}

<!-- The content-block html below is within the redesign_base.html template's `<main class="container">` element. -->

{% block content %}

<!-- JavaScript-savvy URL control to toggle div display between
     #startpanel above & #tabs_bibinfoanditems below -->

<!-- MAIN NAV TABS -->

<div id="tabs_bibinfoanditems" style="margin-top:10em;">

  <h1>
    <em id="sourceTitle"></em>
  </h1>

  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active"
              id="bib-tab"
              data-bs-toggle="tab"
              data-bs-target="#Bibliographic-information"
              type="button" role="tab" aria-controls="Bibliographic-information"
              aria-selected="true">
        About the source
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link"
              id="item-tab"
              data-bs-toggle="tab"
              data-bs-target="#Items"
              type="button" role="tab" aria-controls="Items"
              aria-selected="false">
        Records in this source
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link"
              id="item-tab"
              data-bs-toggle-x="tab"
              data-bs-target-x="#change-source"
              type="button" role="tab" aria-controls="Change source"
              aria-selected="false"
              onclick="document.getElementById('loading-change-source').hidden = false; window.location.href = '../../redesign_citations/'">
        Change to another source
        <img id="loading-change-source" hidden
             src="/static/images/loading-buffering.gif" style="height: 1em">
      </button>
    </li>
  </ul>

  <!-- TAB CONTENT -->

  <div class="tab-content">

    <!-- Citation Tab -->

    <div class="tab-pane show active" style="padding: 20px;"
         role="tabpanel" aria-labelledby="bib-tab"
         id="Bibliographic-information">

      <form id="citation-form"
            vv-on:submit.prevent="onSubmitForm">
        <span class="badge badge-secondary float-right disa-id-badge"
          title="Unique identifier for this citation">
          {{ doc.id }}
        </span>
        <h5 class="text-dark" style="width:25%;float:left;">
          Source type
        </h5>
        <div style="clear: left;margin-bottom: 36px;">
          <select class="form-select" id="document_type"
                  v-model="formData.doc.citation_type_id">
            <!-- If unselected, show this at the top -->
            <option value="0" class="initMessage"
                    v-if="!formData.doc.citation_type_id">
              Select a document type:
            </option>
            <option v-for="(docTypeName, docTypeId) in MENU_OPTIONS.document_type"
                    v-bind:value="docTypeId"
                    v-text="docTypeName">
            </option>
          </select>
  </div>

  <div id="citation-fields"
       style="display:flex; flex-direction:column">

    <!-- HEADERS: Priority vs Optional -->

    <h5 id="required-fields-header" style="order:100;" hidden>
      Priority information
    </h5>
    <h5 id="optional-fields-header" style="order:200;margin-top: 24px;" hidden>
      Additional information
    </h5>

    <!-- FIELDS: Dynamically moved under headings via flexbox order property -->

    <div class="citation-field form-floating" id="abstractNote">
      <input type="text" class="form-control" id="abstractNote-value" 
             aria-label="Abstract Note" placeholder="Abstract Note" 
             v-model="formData.doc.fields.abstractNote">
      <label for="abstractNote-value">Abstract Note</label>
    </div>

    <div class="citation-field form-floating" id="accessDate">
      <label for="accessDate-value">Access Date</label>
      <input type="date" class="form-control" id="accessDate-value" name="accessDate-value" 
             aria-label="Access Date" placeholder="Access Date" 
             v-model="formData.doc.fields.accessDate">
    </div>

    <div class="citation-field form-floating" id="archive">
      <input type="text" class="form-control" id="archive-value" name="archive-value" 
             aria-label="Archive" placeholder="Archive" 
             v-model="formData.doc.fields.archive">
      <label for="archive-value">Archive</label>
    </div>

    <div class="citation-field form-floating" id="archiveLocation">
      <input type="text" class="form-control" id="archiveLocation-value" name="archiveLocation-value" 
             aria-label="Archive Location" placeholder="Archive Location" 
             v-model="formData.doc.fields.archiveLocation">
      <label for="archiveLocation-value">Archive Location</label>
    </div>

    <div class="citation-field form-floating" id="author">
      <input type="text" class="form-control" id="author-value" name="author-value" 
             aria-label="Author" placeholder="Author (last name comes first)" 
             v-model="formData.doc.fields.author">
      <label for="author-value">Author</label>
    </div>

    <div class="citation-field form-floating" id="callNumber">
      <input type="text" class="form-control" id="callNumber-value" name="callNumber-value" 
             aria-label="Call Number" placeholder="Call Number" 
             v-model="formData.doc.fields.callNumber">
      <label for="callNumber-value">Call Number</label>
    </div>

    <div class="citation-field form-group text-dark" id="date">
      <label for="date-value"
        style="padding-right:12px;">Date</label>
      <input id="date-value" class="form-control" name="date-value" placeholder="Date"
             type="date"
             v-model="formData.doc.fields.date" />

      <!-- Broken out with year/month/day for when we have the new DB model -->
      <!--
      <label for="date-year-value">Year
        <input id="date-year-value" name="date-year-value" type="number"
                v-model="formData.doc.citation_type_fields['date-year']" />
      </label>
      <label for="date-month-value">Month
        <select id="date-month-value" name="date-month-value"
                v-model="formData.doc.citation_type_fields['date-month']">
          <option value="0">Not specified</option>
          <option value="1">January</option>
          <option value="2">February</option>
          <option value="3">March</option>
          <option value="4">April</option>
          <option value="5">May</option>
          <option value="6">June</option>
          <option value="7">July</option>
          <option value="8">August</option>
          <option value="9">September</option>
          <option value="10">October</option>
          <option value="11">November</option>
          <option value="12">December</option>
        </select>
      </label>
      <label for="date-day-value">Day
        <select id="date-day-value" name="date-day-value"
                v-model="formData.doc.citation_type_fields['date-day']">
          <option	value="0">	Not specified	</option>
          <option	value="1">	1	</option>
          <option	value="2">	2	</option>
          <option	value="3">	3	</option>
          <option	value="4">	4	</option>
          <option	value="5">	5	</option>
          <option	value="6">	6	</option>
          <option	value="7">	7	</option>
          <option	value="8">	8	</option>
          <option	value="9">	9	</option>
          <option	value="10">	10	</option>
          <option	value="11">	11	</option>
          <option	value="12">	12	</option>
          <option	value="13">	13	</option>
          <option	value="14">	14	</option>
          <option	value="15">	15	</option>
          <option	value="16">	16	</option>
          <option	value="17">	17	</option>
          <option	value="18">	18	</option>
          <option	value="19">	19	</option>
          <option	value="20">	20	</option>
          <option	value="21">	21	</option>
          <option	value="22">	22	</option>
          <option	value="23">	23	</option>
          <option	value="24">	24	</option>
          <option	value="25">	25	</option>
          <option	value="26">	26	</option>
          <option	value="27">	27	</option>
          <option	value="28">	28	</option>
          <option	value="29">	29	</option>
          <option	value="30">	30	</option>
          <option	value="31">	31	</option>
        </select>
      </label>
    -->
    </div>

    <div class="citation-field form-floating" id="edition">
      <input type="text" class="form-control" id="edition-value" name="edition-value" 
             aria-label="Edition" placeholder="Edition" 
             v-model="formData.doc.fields.edition">
      <label for="edition-value">Edition</label>
    </div>

    <div class="citation-field form-floating" id="extra">
      <input type="text" class="form-control" id="extra-value" name="extra-value" 
             aria-label="Extra" placeholder="Extra" 
             v-model="formData.doc.fields.extra">
      <label for="extra-value">Extra</label>
    </div>

    <div class="citation-field form-floating" id="ISBN">
      <input type="text" class="form-control" id="ISBN-value" name="ISBN-value" 
             aria-label="ISBN" placeholder="ISBN" 
             v-model="formData.doc.fields.ISBN">
      <label for="ISBN-value">ISBN</label>
    </div>

    <div class="citation-field form-floating" id="ISSN">
      <input type="text" class="form-control" id="ISSN-value" name="ISSN-value" 
             aria-label="ISSN" placeholder="ISSN" 
             v-model="formData.doc.fields.ISSN">
      <label for="ISSN-value">ISSN</label>
    </div>

    <div class="citation-field form-floating" id="language">
      <!-- @todo SHOULD BE A DROPDOWN? -->
      <input type="text" class="form-control" id="language-value" name="language-value" 
             aria-label="Language" placeholder="Language" 
             v-model="formData.doc.fields.language">
      <label for="language-value">Language</label>
    </div>

    <div class="citation-field form-floating" id="libraryCatalog">
      <input type="text" class="form-control" id="libraryCatalog-value" name="libraryCatalog-value" 
             aria-label="Library Catalog" placeholder="Library Catalog" 
             v-model="formData.doc.fields.libraryCatalog">
      <label for="libraryCatalog-value">Library Catalog</label>
    </div>

    <div class="citation-field form-floating" id="pages">
      <input type="text" class="form-control" id="pages-value" name="pages-value" 
             aria-label="Pages" placeholder="Pages" 
             v-model="formData.doc.fields.pages">
      <label for="pages-value">Pages</label>
    </div>

    <div class="citation-field form-floating" id="place">
      <input type="text" class="form-control" id="place-value" name="place-value" 
             aria-label="Place" placeholder="Place" 
             v-model="formData.doc.fields.place">
      <label for="place-value">Place</label>
    </div>

    <div class="citation-field form-floating" id="publicationTitle">
      <input type="text" class="form-control" id="publicationTitle-value" name="publicationTitle-value" 
             aria-label="Publication Title" placeholder="Publication Title" 
             v-model="formData.doc.fields.publicationTitle">
      <label for="publicationTitle-value">Publication Title</label>
    </div>

    <div class="citation-field form-floating" id="publisher">
      <input type="text" class="form-control" id="publisher-value"
             name="publisher-value" aria-label="Publisher"
             placeholder="Publisher"
             v-model="formData.doc.fields.publisher">
      <label for="publisher-value">Publisher</label>
    </div>

    <div class="citation-field form-floating" id="rights">
      <!-- @todo DROPDOWN? -->
      <input type="text" class="form-control" id="rights-value" name="rights-value" 
             aria-label="Rights" placeholder="Rights" 
             v-model="formData.doc.fields.rights">
      <label for="rights-value">Rights</label>
    </div>

    <div class="citation-field form-floating" id="section">
      <input type="text" class="form-control" id="section-value" name="section-value"
             aria-label="Section" placeholder="Section" 
             v-model="formData.doc.fields.section">
      <label for="section-value">Section</label>
    </div>

    <div class="citation-field form-floating" id="series">
      <input type="text" class="form-control" id="series-value" name="series-value" 
             aria-label="Series" placeholder="Series" 
             v-model="formData.doc.fields.series">
      <label for="series-value">Series</label>
    </div>

    <div class="citation-field form-floating" id="seriesNumber">
      <input type="text" class="form-control" id="seriesNumber-value" name="seriesNumber-value" 
             aria-label="Series Number" placeholder="Series Number" 
             v-model="formData.doc.fields.seriesNumber">
      <label for="seriesNumber-value">Series Number</label>
    </div>

    <div class="citation-field form-floating" id="shortTitle">
      <input type="text" class="form-control" id="shortTitle-value" name="shortTitle-value" 
             aria-label="Short Title" placeholder="Short Title" 
             v-model="formData.doc.fields.shortTitle">
      <label for="shortTitle-value">Short Title</label>
    </div>

    <div class="citation-field form-floating" id="title">
      <input type="text" class="form-control" id="title-value" name="title-value" 
             aria-label="Title" placeholder="Title" 
             v-model="formData.doc.fields.title">
      <label for="title-value">Title</label>
    </div>

    <div class="citation-field form-floating" id="url">
      <input type="text" class="form-control" id="url-value" name="url-value" 
             aria-label="URL" placeholder="Full website link (URL)" 
             v-model="formData.doc.fields.url">
      <label for="url-value">URL</label>
    </div>
  </div>

  <div class="form-floating">
      <textarea class="form-control" id="formInputDISAAcknowledgements" 
                placeholder="Enter notes here..."
                v-model="formData.doc.acknowledgements"
                style="height: 128px"></textarea>
      <label for="formInputDISAAcknowledgements">Acknowledgements</label>
  </div>

  <div class="form-floating">
      <textarea class="form-control" id="formInputDISABiblioResearcherNotes" 
                placeholder="Enter notes here..." 
                v-model="formData.doc.comments"
                style="height: 128px"></textarea>
      <label for="formInputDISABiblioResearcherNotes">Researcher notes</label>
      <button class="btn btn-link btn-sm mb-3"
          vv-on:click=""
          title="Open an email to Stolen Relations help">
        Report problems or ask for help
      </button>
  </div>

  <a type="button" class="btn btn-primary btn-md" href="../../redesign_citations/">
    &nwarr; save source and exit
  </a>

  <button type="button" class="btn btn-primary btn-md" id="citation-form-submit"
          v-on:click="openItemTab">
    save source and continue to enter records &rarr;
  </button>

  </form>
    </div> <!-- /.tab-pane for bibinfo -->

    <!-- Record Tab -->

    <div class="tab-pane card-body"
         role="tabpanel" aria-labelledby="item-tab" id="Items">
    
      <!-- "Save status" indicator -->

      <disa-save-status ref="database"></disa-save-status>

      <!-- "Change Record" modal -->
      
      <div class="modal" tabindex="-1" id="item-selector-modal">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">
                Select a record to edit
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-start"
                    data-bs-dismiss="modal"
                    v-for="item in formData.doc.references"
                    v-on:click="currentItemId = item.id">
                  <div class="ms-2 me-auto"
                       v-text="makeItemDisplayTitle(item, 50)">
                  </div>
                  <disa-id v-bind:forthis="item" class="float-end"></disa-id>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- "Confirm delete" modal -->
<!--
      <div class="modal" tabindex="-1" id="confirm-delete">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Are you sure you want to delete?</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No - do not delete</button>
              <button type="button" class="btn btn-primary">Yes! Please delete</button>
            </div>
          </div>
        </div>
      </div> -->
      
      <!-- Actual Record tab content -->

      <div class="tab-content" style="background-color: white!important;opacity:1;">

        <div class="active tab-pane" role="tabpanel" aria-labelledby="New-Item"
             id="New-Item">

          <!-- If no Record currently selected, then show list of all Records -->

          <div v-if="currentItemId === -1 || !currentItemId">

            <h1>
              Records contained within this Source
              <button type="button" class="btn btn-link"
                      v-on:click="createNewItem">
                +new
              </button>
            </h1>

            <p>Select to open a Record</p>

            <ul class="list-group">
              <li class="list-group-item d-flex justify-content-between align-items-start"
                  v-for="item in formData.doc.references"
                  v-on:click="currentItemId = item.id">
                <div class="ms-2 me-auto btn btn-link"
                     v-text="makeItemDisplayTitle(item, 50)">
                </div>
                <disa-id v-bind:forthis="item" class="float-end"></disa-id>
              </li>
            </ul>
          </div>

          <!-- If there IS a current Record selected, then show edit interface for that Record -->

          <!-- start edit Record form -->

          <div v-else> 
              
            <!-- Top control panel: title, Record selector, and new Record button -->

            <div class="card bg-light">
              <div class="card-body">

                <!-- Main title -->

                <disa-id v-bind:forthis="currentItem" class="float-end"></disa-id>
                <h2>
                  <em v-html="makeItemDisplayTitle(currentItem)"></em>
                </h2>
                <div class="float-end">

                  <!-- Change Record button if more than one Record
                        (opens modal #item-selector-modal, defined above) -->

                  records: 
                  <button type="button" class="btn btn-link btn-sm"
                          v-if="Object.values(formData.doc.references).length > 1"
                          data-bs-toggle-x="modal" data-bs-target-x="#item-selector-modal"
                          v-on:click="currentItemId = -1">
                    show all
                  </button>

                  <!-- Create new Record button

                  <button type="button" class="btn btn-link btn-sm"
                          v-on:click="createNewItem">
                    +new
                  </button> -->

                  <!-- Delete Record button -->

                  <button type="button" class="btn btn-link btn-sm"
                          v-on:click="deleteItem">
                    &times;&nbsp;delete
                  </button>
                </div>
              </div>
            </div>

            <!-- Main Record input form -->

            <div id="item-form">
              <form>
                <div class="row col-lg-12" style="padding-top:40px;padding-left:25px;">

                  <!-- Record location not in current DB model

                  <div class="col-md-6">

                    <h5 class="text-dark" style="float:left;">
                      Record's location in source document
                    </h5>

                    <!-/- Record page numbers -/->

                    <div class="form-floating">
                      <label for="formInputDISAItemVolume">Volume</label>
                      <input type="number" class="form-control"
                            id="formInputDISAItemVolume" aria-label="Volume"
                            placeholder="Volume in source" v-model="currentItem.volume">
                    </div>
                    <div class="form-floating">
                      <div class="input-group mb-3">
                        <span class="input-group-text">Page numbers from</span>
                        <input type="number"
                              class="form-control" id="formInputDISASourcePageStart"
                              aria-label="starting page number"
                              v-model="currentItem.page_start"
                              placeholder="starting page">
                        <span class="input-group-text">to</span>
                        <input type="number"
                              class="form-control" id="formInputDISASourcePageEnd" aria-label="ending page number"
                              placeholder="ending page" v-model="currentItem.page_end">
                      </div>
                    </div>
                  </div>
                  -->
                  
                  <!-- Record type and transcription area-->

                  <div class="col-md-12"> <!-- Change to col-md-6 when Record location added above -->
                    <!--
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#confirm-delete">
                      Launch demo modal
                    </button>-->

                    <h5 class="text-dark">Record content</h5>
                    <div class="form-floating">

                      <!-- Record type dropdown -->

                      <select class="form-select"
                              id="formInputDISAItemType"
                              aria-label=""
                              v-model="currentItem.kludge.reference_type_id">
                        <option v-for="(itemTypeOption, itemTypeOptionId) in MENU_OPTIONS.formInputDISAItemType"
                                v-bind:value="itemTypeOptionId"
                                v-text="itemTypeOption"></option>
                      </select>
                      <label for="formInputDISAItemType">Record type</label>
                    </div>

                    <!-- Image URL -->

                    <div class="form-floating">
                      <input class="form-control" type="url" placeholder="URL of image"
                            v-model="currentItem.kludge.image_url"></input>
                      <label for="formInputDISAItemImage">Image URL</label>
                    </div>

                    <div class="form-floating mb-5">

                      <!-- Transcription textarea -->

                      <h6>Transcription</h6>
                      <wysiwyg-editor api-key="ondkaoffzc1dnoz0vypajv5qg9fvnun0bss1ew22yncnvquc" 
                                      toolbar="bold italic fullscreen"
                                      :init="{ height:200,menubar:false,plugins:['fullscreen'], toolbar_mode: 'floating'}"
                                      v-model="currentItem.kludge.transcription"></wysiwyg-editor>

                    </div>
                </div> <!-- /.row -->
                <hr />

                <!-- Record date and location -->

                <div class="row" style="padding:25px;">

                  <!-- Record date -->
                  
                  <div class="col-md-6">
                    <h5 class="text-dark">Event date</h5>

                    <div class="input-group mb-3">

                      <select class="form-select" id="formInputDISAEventDateMonth"
                              aria-label="Event date: month" placeholder="Month"
                              v-model="currentItem.dateParts.month">
                        <option value="-1">Month unspecified</option>
                        <option value="01">January</option>
                        <option value="02">February</option>
                        <option value="03">March</option>
                        <option value="04">April</option>
                        <option value="05">May</option>
                        <option value="06">June</option>
                        <option value="07">July</option>
                        <option value="08">August</option>
                        <option value="09">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                      </select>
                      <input class="form-control" id="formInputDISAEventDateDay"
                              type="number" min="0" max="31" placeholder="Day"
                              v-model="currentItem.dateParts.day">
                      <input class="form-control" id="formInputDISAEventDateYear"
                              type="number" min="1500" max="1900" placeholder="Year"
                              v-model="currentItem.dateParts.year">
                    </div>

                    <!-- AWAITING NEW DATA MODEL
                    <div class="form-floating">
                      <input type="text" class="form-control" id="formInputDISAEventDateInfo" aria-label="Additional date information" placeholder="Additional date info.">
                      <label for="formInputDISAEventDateInfo">Additional date info.</label>
                    </div> -->

                  </div>

                  <!-- Record location -->

                  <div class="col-md-6">
                    <h5 class="text-dark">Place</h5>
                    <div class="form-floating">

                      <!-- Colonial context -->

                      <select class="form-select" id="formInputDISAColonialContext" aria-label="Colonial context"
                              v-model="currentItem.national_context_id">
                        <option v-for="(colonialContextOption, colonialContextOptionId) in MENU_OPTIONS.formInputDISAColonialContext"
                                v-bind:value="colonialContextOptionId"
                                v-text="colonialContextOption">
                      </select>
                      <label for="formInputDISAColonialContext">Colonial context</label>
                    </div>

                    <!-- Colony / state -->

                    <div class="form-floating">
                      <input type="text" class="form-control" id="formInputDISAColonyState" 
                            aria-label="Colony / State" placeholder="Colony / State"
                            v-model="currentItem.location_info['Colony/State'].name">
                      <label for="formInputDISAColonyState">Colony / State</label>
                    </div>
                    
                    <!-- City -->

                    <div class="form-floating">
                      <input type="text" class="form-control" id="formInputDISATown" 
                            aria-label="Town" placeholder="Town"
                            v-model="currentItem.location_info['City'].name">
                      <label for="formInputDISATown">Town</label>
                    </div>
                    <div class="form-floating">

                      <!-- Additional location info -->

                      <input type="text" class="form-control" id="formInputDISAPlaceInfo" 
                            aria-label="Additional location information" placeholder="Additional location info."
                            v-model="currentItem.location_info['Locale'].name">
                      <label for="formInputDISAPlaceInfo">Additional location info.</label>
                    </div>
                  </div>
                </div>
                <hr>

                <!-- People (Referents/individuals and groups) -->

                <div class="row" style="padding-top:20px;padding-right:20px;">
                  <div class="col-md-12" style="margin-left: 40px;">

                    <!-- Add new referents and group button -->

                    <h5 class="text-dark col-12" style="float:left;">People
                      <button class="btn btn-link btn-sm"
                              v-if="currentItem.referents.length === 0"
                              v-on:click="makeNewReferent"
                              title="Enter information for a new person">
                        +new individual
                      </button>
                      <button class="btn btn-link btn-sm"
                              v-if="currentItem.groups.length === 0"
                              v-on:click="makeNewGroup"
                              title="Enter information for a new group">
                        +new group
                      </button>
                    </h5>

                    <!-- Individuals-->

                    <div v-if="currentItem.referents.length > 0" class="mt-3">
                      <h6 style="float:left;">Individuals</h6>
                      <button class="btn btn-link btn-sm"
                              v-on:click="makeNewReferent"
                              title="Enter information for a new person">
                        +new
                      </button>
                    </div>

                    <div class="col-lg-12" style="padding-right: 40px; clear: both">
                      <div class="card"
                          v-for="referent in currentItem.referents"
                          v-bind:class="{ 
                            'is-current': currentReferentId === referent.id,
                            'border-white': currentReferentId !== referent.id
                          }">

                        <!-- Main (clickable accordion) header for this referent -->

                        <div class="card-header clickable"
                            v-bind:class="{
                              'bg-transparent': currentReferentId !== referent.id,
                              'border-white': currentReferentId !== referent.id
                            }"
                            v-on:click="currentReferentId = (currentReferentId === referent.id) ? -1 : referent.id">
                          <span v-text="getReferentDisplayLabel(referent)" class="sr-referent-heading"></span>
                          <disa-id v-bind:forthis="referent" class="float-end"></disa-id>
                          <span title="Delete this individual" 
                              class="btn btn-link btn-sm delete-link float-end"
                              v-on:click="deleteReferent(referent)">
                            &times;&nbsp;delete
                          </span>
                        </div>

                        <!-- Edit area for this referent -->

                        <div class="card-body"
                            v-if="currentReferentId === referent.id">

                          <!-- Name(s) -->

                          <h6>Name</h6>

                          <!-- WAITING FOR NEW MODEL (multiple names, advanced model)

                          <div class="card card-body">

                            <!-/- Heading and create-new-name button -/->
                            <div>
                              <strong v-text="'Name' + (referent.names && referent.names.length > 1 ? 's' : '')"></strong>
                              <button type="button" class="btn btn-link btn-sm" id="formInputDISAPersonAddName"
                                      v-on:click="makeNewReferentName"
                                      title="Enter new name for this person">
                                +new
                              </button>
                            </div>

                            <!-/- List of names (WAITING FOR NEW MODEL) -/->
                            <ul>
                              <li v-for="name in referent.names">
                                <div v-on:click="currentNameId = (currentNameId === name.id) ? -1 : name.id">
                                  <span v-if="name.first || name.last">
                                    <span v-text="`${name.first} ${name.last}  `"></span>
                                    <disa-id v-if="currentNameId === name.id" v-bind:forthis="name"></disa-id>
                                  </span>
                                  <em v-else>
                                    New name
                                  </em>
                                </div>

                                <!-/- Current name - details -/->

                                <div v-if="currentNameId === name.id">

                                  <!-/- ADVANCED NAMES - DEFER FOR NEW MODEL
                                  <div class="custom-control custom-switch" style="">
                                    <input type="checkbox" class="custom-control-input" id="formCustomSwitchForAdvancedNames"
                                            v-model="referent.name">
                                    <label style="font-size: 85%;margin-top: -10px;font-weight:bold;"
                                            class="custom-control-label" for="formCustomSwitchForAdvancedNames">
                                      ADVANCED NAME OPTIONS (if the first / last name designation doesn't apply)
                                    </label>
                                  </div> -/->

                                  <div class="form-floating">
                                    <select class="form-select" id="formInputDISAItemPersonNameType" 
                                            aria-label="Name type"
                                            v-model="name.name_type">
                                      <option v-for="(nameTypeMenuLabel, nameTypeId) in MENU_OPTIONS.formInputDISAItemPersonNameType"
                                              v-bind:value="nameTypeId"
                                              v-text="nameTypeMenuLabel">
                                      </option>
                                    </select>
                                    <label for="formInputDISAItemPersonNameType">Name type</label>
                                  </div>
                                  <!-/- NAME TRANSCRIPTION - DEFER TO V2? OR DROP?
                                  <div class="form-floating">
                                    <input type="text"
                                            class="form-control" id="formInputDISAItemPersonNameTranscription"
                                            aria-label="Full name transcription"
                                            placeholder="The name as it's written in the document"
                                            v-model="referent.transcription">
                                    <label for="formInputDISAItemPersonNameTranscription">Full name transcription</label>
                                  </div> -/->
                                  <div class="form-floating">
                                    <input type="text" class="form-control" id="formInputDISAItemPersonFirstName"
                                            aria-label="First name" placeholder="First name"
                                            v-model="name.first">
                                    <label for="formInputDISAItemPersonFirstName">First name</label>
                                  </div>
                                  <div class="form-floating">
                                    <input type="text" class="form-control" id="formInputDISAItemPersonLastName"
                                            aria-label="Last name" placeholder="Last name"
                                            v-model="name.last">
                                    <label for="formInputDISAItemPersonLastName">Last name</label>
                                  </div>
                                </div>
                              </li>
                            </ul> 
                          </div>-->


                            <!-- START - SINGLE, SIMPLE NAME INTERFACE
                                (will be replaced by above with new model) -->

                          <div class="row">
                            <div class="form-floating col-4">
                              <input type="text" class="form-control" id="formInputDISAItemPersonFirstName"
                                      aria-label="First name" placeholder="First name"
                                      v-model="referent.names[0].first">
                              <label for="formInputDISAItemPersonFirstName">First name</label>
                            </div>
                            <div class="form-floating col-4">
                              <input type="text" class="form-control" id="formInputDISAItemPersonLastName"
                                      aria-label="Last name" placeholder="Last name"
                                      v-model="referent.names[0].last">
                              <label for="formInputDISAItemPersonLastName">Last name</label>
                            </div>
                            <div class="form-floating col-4">
                              <select class="form-select" id="formInputDISAItemPersonNameType" 
                                      aria-label="Name type"
                                      v-model="referent.names[0].name_type">
                                <option v-for="(nameTypeMenuLabel, nameTypeId) in MENU_OPTIONS.formInputDISAItemPersonNameType"
                                        v-bind:value="nameTypeId"
                                        v-text="nameTypeMenuLabel">
                                </option>
                              </select>
                              <label for="formInputDISAItemPersonNameType">Name type</label>
                            </div>
                          </div>

                          <!-- END - SINGLE, SIMPLE NAME INTERFACE -->
                          
                          <div class="row" style="padding-top:10px;clear: both;">
                            <div class="col-md-6">

                              <!-- Gender -->

                              <div class="form-floating">
                                <select class="form-select" id="formInputDISAPersonGender"
                                        aria-label="New person's gender" placeholder="Gender"
                                        v-model="referent.sex">
                                  <option v-for="(genderOption, genderOptionId) in MENU_OPTIONS.formInputDISAPersonGender"
                                          v-bind:value="genderOptionId"
                                          v-text="genderOption">
                                </select>
                                <label for="formInputDISAPersonGender">Gender</label>
                              </div>

                              <!-- Age -->

                              <div class="form-group">
                                <div class="form-floating"> <!--
                                  <input v-model="referent.age" id="formInputDISAPersonAge"></input>
                                  <label for="formInputDISAPersonAge">Age</label> -->

                                  <!-- BELOW IS FOR NEW MODEL WITH AGE AS NUMBER OR TEXT -->
                                  <!--
                                  <input vv-if="TEST FOR age_number"
                                          type="number" min="0" max="110"> -->
                                  <select class="form-select" id="formInputDISAPersonAge_number" 
                                          aria-label="New person's age (number)" 
                                          placeholder="New person's age (number)">
                                    <option selected>&nbsp;</option>
                                    <option value="-1">Unspecified</option>
                                    <option value="1">1 year</option>
                                    <option value="2">2 years</option>
                                    <option value="3">3 years</option>
                                  </select>
                                  <label for="formInputDISAPersonAge_number">Age</label>
                                  <input type="text" class="form-control" id="formInputDISAPersonAge_text" 
                                        aria-label="New person's age (text)" placeholder="New person's age (text)"
                                        v-model="referent.age">
                                  <!-- WAITING FOR NEW MODEL
                                  <div class="form-check" style="margin-top:-6px;">
                                    <input class="form-check-input" style="margin-left:.125em;" type="checkbox" id="formInputSpecifiedByNumber" value="option1">
                                    <label class="form-check-label" style="font-size: 85%;font-weight:bold;margin-left:.5em;margin-top:-10px;" 
                                          for="formInputSpecifiedByNumber">
                                      AGE SPECIFIED BY A NUMBER
                                    </label>
                                  </div>-->
                                </div>
                              </div>

                              <!-- Status -->

                              <div class="form-floating-x" style="clear: both">
                                  <label for="formInputDISAPersonStatus">Status</label>
                                  <!--
                                  <disa-tags v-bind:value="referent.status"
                                            v-bind:suggestions="MENU_OPTIONS.formInputDISAPersonStatus"
                                            id="formInputDISAPersonStatus"></disa-tags> -->
                                <!--
                                <input class="form-select taggedInput" id="formInputDISAPersonStatus" aria-label="New person's status"
                                        value="yes1, yes2, yes3"
                                        placeholder="Status">
                                  </input>-->
                              </div>
                              <div class="form-floating">
                                <input type="text" class="form-control" id="formInputDISAStatusInfo" aria-label="Additional status information" placeholder="Additional status info.">
                                <label for="formInputDISAStatusInfo">Additional status info.</label>
                              </div>

                              <!-- Vocation -->

                              <div class="row mb-4">
                                <label for="formInputDISAPersonVocation" class="col-sm-3 col-form-label" style="text-align: left;">Vocation</label>
                                <div class="col-sm-9">
                                <disa-tags v-model="currentReferent.vocations"
                                            v-bind:suggestions="MENU_OPTIONS.formInputDISAPersonVocation"
                                            id="formInputDISAPersonVocation"></disa-tags>
                                </div>
                              </div>
                              <!-- VOCATION AS DROPDOWN ...
                              <div class="form-floating">
                                <select class="form-select" id="formInputDISAPersonVocation" aria-label="Vocation" placeholder="Vocation">
                                  <option v-for="(vocationOption, vocationOptionId) in MENU_OPTIONS.formInputDISAPersonVocation"
                                          v-bind:value="vocationOptionId"
                                          v-text="vocationOption">
                                  </option>
                                </select>
                                <label for="formInputDISAPersonVocation">Vocation</label>
                              </div> -->
                            </div>
                            <div class="col-md-6">

                              <!-- Race -->

                              <div class="row mb-4">
                                <label for="formInputDISAPersonRace" class="col-sm-4 col-form-label" style="text-align: right;">Race</label>
                                <div class="col-sm-8">
                                  <disa-tags v-model="currentReferent.races"
                                          v-bind:suggestions="MENU_OPTIONS.formInputDISAPersonRace"
                                          id="formInputDISAPersonRace"></disa-tags>
                                  </div>
                              </div>

                              <!-- NEW MODEL: only one race as dropdown
                              <div class="form-floating">
                                <select class="form-select" id="formInputDISAPersonRace" 
                                        aria-label="This person's race designation"
                                        v-model="currentReferent.race">
                                    <option v-for="(raceOption, raceOptionId) in MENU_OPTIONS.formInputDISAPersonRace"
                                            v-bind:value="raceOptionId"
                                            v-text="raceOption"></option>
                                </select>
                                <label for="formInputDISAPersonRace">Race</label>
                              </div>  -->

                              <!-- NEW MODEL: Transcription of race text
                              <div class="form-floating">
                                <input type="text" class="form-control" id="formInputDISAPersonRaceTerms" 
                                      aria-label="Exact racial terms used" placeholder="Exact racial terms used">
                                <label for="formInputDISAPersonRaceTerms">Exact racial terms used</label>
                              </div>  -->

                              <!-- Tribe -->

                              <div class="row mb-4">
                                <label for="formInputDISAPersonTribe" class="col-sm-4 col-form-label" style="text-align: right;">Tribal Nation</label>
                                <div class="col-sm-8">
                                <disa-tags v-model="currentReferent.tribes"
                                          v-bind:suggestions="MENU_OPTIONS.formInputDISAPersonTribe"
                                          id="formInputDISAPersonTribe"></disa-tags>
                                </div>
                              </div>

                              <!-- NEW MODEL: Transcribed geographical terms  
                              <div class="form-floating">
                                <input type="text" class="form-control" id="formInputDISAPersonTribeTerms" 
                                      aria-label="Exact identity/geographical terms used" 
                                      placeholder="Exact identity/geographical terms used">
                                <label for="formInputDISAPersonTribeTerms">Exact identity/geographical terms used</label>
                              </div> -->

                              <!-- Geographical origins -->

                              <div class="row mb-4">
                                <label for="formInputDISAPersonGeoOrigins" class="col-sm-4 col-form-label" style="text-align: right;">Geographic origins</label>
                                <div class="col-sm-8">
                                <disa-tags v-model="currentReferent.origins"
                                  v-bind:suggestions="MENU_OPTIONS.formInputDISAPersonGeoOrigins"
                                  id="formInputDISAPersonGeoOrigins"></disa-tags>
                              </div>

                            </div>
                          </div>
                          <div class="card card-body" style-x="padding-top:10px;clear: both;">

                            <!-- Relationships -->

                            <div>
                              <strong>Relationships</strong>
                              <button class="btn btn-link btn-sm"
                                      v-on:click="newRelationshipFormVisible = true"
                                      title="Enter information for a new relationship">
                                +new
                              </button>
                            </div>

                            <!-- Existing relationships -->

                            <div class="row"
                                v-for="relationship in currentReferentRelationships">

                              <div class="" style="text-align: left">
                                <!-- Subject of relationship (i.e. the current referent) -->
                                <span v-text="getReferentDisplayLabel(referent)"></span> is
                                <!-- Relationship type -->
                                <span v-text="MENU_OPTIONS.formInputDISARelationship[relationship.data.rel.id]"></span>
                                <!-- Object of relationship -->
                                <span v-text="getReferentDisplayLabelById(relationship.data.obj.id)"></span>
                                <disa-id v-bind:forthis="relationship" class="float-end-x"></disa-id>
                                <span title="Delete this relationship" class="btn btn-link btn-sm"
                                      v-on:click="deleteRelationship(relationship)">
                                  &times;&nbsp;delete
                                </span>
                              </div>
                            </div>

                            <!-- New relationship -->

                            <div class="row" v-if="newRelationshipFormVisible">

                              <!-- Subject of relationship (i.e. the current referent) -->

                              <hr />
                              <div><em>Add a new relationship</em></div>
                              <div class="col-md-3" style="text-align: left">
                                <span v-text="getReferentDisplayLabel(referent)"></span> is ...
                              </div>

                              <!-- Relationship type -->

                              <div class="col-md-4">
                                <select class="form-select" id="formInputDISARelationship" 
                                        aria-label="Type of relationship"
                                        v-model="newRelationship.rel">
                                  <option v-for="(relationshipTypeOption, relationshipTypeId) in MENU_OPTIONS.formInputDISARelationship"
                                          v-bind:value="relationshipTypeId"
                                          v-text="relationshipTypeOption"></option>
                                </select>
                              </div>

                              <!-- Object of relationship (only show dropdown if there are more than 2 referents) -->

                              <div v-if="currentItem.referents.length > 2"
                                  class="col-md-4">
                                  
                                <select class="form-select" id="formInputDISARelationshipObject" 
                                        aria-label="Who is in the relationship"
                                        v-model="newRelationship.obj">
                                  <option v-for="relationshipObject in currentItem.referents"
                                          v-if="relationshipObject.id != referent.id"
                                          v-bind:value="relationshipObject.id"
                                          v-text="getReferentDisplayLabel(relationshipObject)">
                                  </option>
                                </select>
                              </div>

                              <!-- If only one other referent (besides current) just show name as text -->

                              <div v-else class="col-md-4"
                                  v-text="'... ' + getReferentDisplayLabel(currentItem.referents.find(r => r !== currentReferent))">
                              </div>
                              <!-- Relationship save button -->
                              <div class="col">
                                <button title="Save this relationship" class="btn btn-primary btn-sm"
                                        v-on:click="createRelationship()">
                                  save
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>    
                      </div>
                    </div>

                    <!-- Groups -->

                    <div v-if="currentItem.groups.length > 0" class="mt-3">
                      <h6 style="float:left;">Groups</h6>
                      <button class="btn btn-link btn-sm"
                              v-on:click="makeNewGroup"
                              title="Enter information for a new group">
                        +new
                      </button>
                    </div>

                    <div class="col-lg-12" style="padding-right: 40px; clear: both">
                        <div class="card"
                            v-for="group in currentItem.groups"
                            v-bind:class="{ 
                              'is-current': currentGroupId === group.uuid,
                              'border-white': currentGroupId !== group.uuid
                            }">

                          <!-- Main (clickable accordion) header for this group -->

                          <div class="card-header clickable"
                              v-bind:class="{
                                'bg-transparent': currentGroupId !== group.uuid,
                                'border-white': currentGroupId !== group.uuid
                              }"
                              v-on:click="currentGroupId = (currentGroupId === group.uuid) ? -1 : group.uuid">
                            <span v-text="getGroupDisplayLabel(group)" class="sr-referent-heading"></span>
                            <span title="Delete this group" 
                                  class="btn btn-link btn-sm delete-link"
                                  v-on:click.self="deleteGroup(group)">
                              &times;&nbsp;delete
                            </span>
                            <disa-id v-bind:forthis="group" class="float-end"></disa-id>
                          </div>

                          <!-- Edit area for this group -->

                          <div class="card-body"
                              v-if="currentGroupId === group.uuid">

                              <!-- Group description -->

                              <div class="form-floating">
                                  <textarea class="form-control" id="formInputGroupDescription" 
                                            placeholder="Description from source"
                                            v-model="group.description">
                                  </textarea>
                                  <label for="formInputGroupDescription">Description</label>
                              </div>

                              <!-- Group Count -->

                              <div class="form-floating col-lg-8">
                                <input type="number" class="form-control"
                                      id="formInputDISAGroupCount" aria-label="Count of people in group"
                                      placeholder="" v-model="group.count">
                                <label for="formInputDISAGroupCount">Number of individuals in group</label>
                              </div>

                              <!-- Group count - estimated -->

                              <div class="form-check col-lg-4" style="margin-top:-6px;">
                                <input class="form-check-input" style="margin-left:.125em;" type="checkbox" 
                                      id="formInputDISAGroupCountEstimated"
                                      v-model="group.count_estimated">
                                <label class="form-check-label" style="font-size: 85%;font-weight:bold;margin-left:.5em;margin-top:-10px;" 
                                      for="formInputDISAGroupCountEstimated">
                                  Estimated
                                </label>
                              </div>
                          </div>
                        </div>
                    </div>
                  </div>
                </div>

                <!-- Record notes -->
                <!-- 
                <hr />
                <h5>Notes</h5> 
                -->
                <div class="col-lg-12" style="padding-top:20px;padding-left:40px;padding-right:40px;padding-bottom:40px;">

                  <!-- RESEARCHER NOTES ARE FOR NEW MODEL
                  <div class="form-floating">
                    <textarea class="form-control" placeholder="Enter notes here..." id="formInputDISAPeopleResearcherNotes" style="height: 128px"></textarea>
                    <label for="formInputDISAPeopleResearcherNotes">Researcher notes</label>
                    <a href="#" style="font-size:80%;font-weight:bold;clear:left;">Report problems or ask for help</a> 
                  </div>-->

                  <!-- IS THIS BUTTON NECESSARY? 
                  <button type="button" class="btn btn-secondary btn-md" style="font-weight: bold;margin-top: 20px;">
                    ALL CHANGES SAVED
                  </button> 
                  -->
                  <a type="button" class="btn btn-primary btn-md" href="../../redesign_citations/">
                    &nwarr; save record and exit this source
                  </a>
                </div>
              </form>
            </div>
          </div> <!-- end edit Record form -->
        </div> <!-- /.tab-pane for Record -->
      </div> <!-- /.tab-content for Record -->
    <!-- </div> -->

    </div>
  </div>
</div> <!-- /#tabs_bibinfoanditems -->

{% endblock content %}


{% block page_specific_js %}


{% endblock page_specific_js %}
